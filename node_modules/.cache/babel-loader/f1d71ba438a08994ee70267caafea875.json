{"ast":null,"code":"import _objectWithoutProperties from\"/home/intelie/Documents/srt2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _toConsumableArray from\"/home/intelie/Documents/srt2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/home/intelie/Documents/srt2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _defineProperty from\"/home/intelie/Documents/srt2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _slicedToArray from\"/home/intelie/Documents/srt2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* eslint-disable react/jsx-no-undef */import React,{useEffect,useState}from\"react\";import{Form,Button,DropdownButton,Dropdown,Row,Col,InputGroup,FormControl}from\"react-bootstrap\";import{parseObjectToPSRT,parsePSRTToObject}from\"../service/subtitle\";var BG_SELECT_COLOR=\"#0f04\";//import DragScaleBar from 'react-drag-scale-bar'\n// import { Container } from './styles';\nvar EditSub=function EditSub(_ref){var _sub$,_sub$String,_Object$keys;var sub=_ref.sub,setSub=_ref.setSub,defaultPage=_ref.page,setDefaultPage=_ref.setPage,setImage=_ref.setImage,image=_ref.image,setImageStyle=_ref.setImageStyle,setEditStyles=_ref.setEditStyles;var _useState=useState(defaultPage||\"page1\"),_useState2=_slicedToArray(_useState,2),page=_useState2[0],setPage=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isNewPage=_useState4[0],setIsNewPage=_useState4[1];var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),index=_useState6[0],setIndex=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),x=_useState8[0],setX=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),y=_useState10[0],setY=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),width=_useState12[0],setWidth=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),size=_useState14[0],setSize=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),subText=_useState16[0],setSubText=_useState16[1];var _useState17=useState(true),_useState18=_slicedToArray(_useState17,2),show=_useState18[0],setShow=_useState18[1];var _useState19=useState({}),_useState20=_slicedToArray(_useState19,2),style=_useState20[0],setStyle=_useState20[1];var _useState21=useState(\"\"),_useState22=_slicedToArray(_useState21,2),keyStyle=_useState22[0],setKeyStyle=_useState22[1];var _useState23=useState(\"\"),_useState24=_slicedToArray(_useState23,2),valueStyle=_useState24[0],setValueStyle=_useState24[1];var _useState25=useState(\"sub\"),_useState26=_slicedToArray(_useState25,2),dowloadFileName=_useState26[0],setDowloadFileName=_useState26[1];var _useState27=useState(((_sub$=sub[\"\".concat(page)])===null||_sub$===void 0?void 0:_sub$.reduce(function(p,c){return c.index>p?c.index:p;},0))+1),_useState28=_slicedToArray(_useState27,2),lastIndex=_useState28[0],setLastIndex=_useState28[1];var handleChangeSub=function handleChangeSub(){setEditStyles(_defineProperty({},page,_defineProperty({},index,{backgroundColor:BG_SELECT_COLOR})));if(Object.keys(sub).includes(page)){try{setSub(function(data){var _data$page;return _objectSpread(_objectSpread({},data),{},_defineProperty({},page,_toConsumableArray((_data$page=data[page])===null||_data$page===void 0?void 0:_data$page.map(function(txt){if(txt.index===parseInt(String(index))){return _objectSpread(_objectSpread({},txt),{},{x:parseFloat(x),y:parseFloat(y),width:parseFloat(width),size:parseFloat(size),text:subText,style:_objectSpread({},style)});}else{return txt;}}))));});}catch(error){console.log(error);}}};useEffect(function(){//console.log(sub);\nhandleChangeSub();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[x,y,width,size,subText,style,defaultPage]);var updateSubInfos=function updateSubInfos(newSub){var _sub=newSub||sub;if(page){var _sub$page;var text=(_sub$page=_sub[page])===null||_sub$page===void 0?void 0:_sub$page.find(function(a){return a.index===parseInt(String(index));});setX(function(oldX){return(text===null||text===void 0?void 0:text.x)||oldX;});setY(function(oldY){return(text===null||text===void 0?void 0:text.y)||oldY;});setWidth(function(oldW){return(text===null||text===void 0?void 0:text.width)||oldW;});setSize(function(oldS){return(text===null||text===void 0?void 0:text.size)||oldS;});setSubText((text===null||text===void 0?void 0:text.text)||\"\");setStyle(function(old){return(text===null||text===void 0?void 0:text.style)?_objectSpread({},text===null||text===void 0?void 0:text.style):_objectSpread({},old);});}};var addNewText=function addNewText(){setSub(function(data){return _objectSpread(_objectSpread({},data),{},_defineProperty({},page,[].concat(_toConsumableArray(data[page]),[{index:parseInt(String(lastIndex)),x:parseFloat(String(x)),y:parseFloat(String(y)),width:parseFloat(String(width)),size:parseFloat(String(size)),text:subText,style:_objectSpread(_objectSpread({},style),{},{backgroundColor:BG_SELECT_COLOR})}])));});setIndex(lastIndex);setLastIndex(function(old){return old+1;});};var addNewPage=function addNewPage(){if(isNewPage){setSub(_objectSpread(_objectSpread({},sub),{},_defineProperty({},page,[{index:parseInt(String(0)),x:parseFloat(String(x)),y:parseFloat(String(y)),width:parseFloat(String(width)),size:parseFloat(String(size)),text:subText,style:_objectSpread(_objectSpread({},style),{},{backgroundColor:BG_SELECT_COLOR})}])));updateSubInfos(sub);setIndex(0);setLastIndex(1);setDefaultPage(page);updateSubInfos();}};var updateSubtitleFile=function updateSubtitleFile(fr){var _newSub$page;localStorage.setItem(\"lastPSRT\",String(fr.result));var newSub=parsePSRTToObject(String(fr.result));setSub(newSub);setLastIndex(((_newSub$page=newSub[page])===null||_newSub$page===void 0?void 0:_newSub$page.reduce(function(p,_ref2){var index=_ref2.index;return index>p?index:p;},0))+1);updateSubInfos(newSub);};var showImage=function showImage(fr){localStorage.setItem(\"lastImage\",String(fr.result));setImage(String(fr.result));};var handleAddStyle=function handleAddStyle(){setStyle(function(old){return _objectSpread(_objectSpread({},old),{},_defineProperty({},keyStyle,valueStyle));});setValueStyle(\"\");setKeyStyle(\"\");};var handleRemoveStyle=function handleRemoveStyle(key){setValueStyle(style[key]);setKeyStyle(key);var newStyles=_objectSpread({},style);delete newStyles[key];setStyle(newStyles);};var handleClearAll=function handleClearAll(){var newSub={page1:[]};setSub(newSub);setPage(\"page1\");setIndex(0);setLastIndex(0);};useEffect(function(){updateSubInfos();},[index,page]);useEffect(function(){var _sub$page2;setIsNewPage(!Object.keys(sub).includes(page));Object.keys(sub).includes(page)&&setDefaultPage(page);setLastIndex(((_sub$page2=sub[page])===null||_sub$page2===void 0?void 0:_sub$page2.reduce(function(p,_ref3){var index=_ref3.index;return index>p?index:p;},0))+1);},[page]);return/*#__PURE__*/_jsxs(Form,{style:{position:\"fixed\",width:\"500px\",left:0,overflowY:\"auto\",overflowX:\"hidden\",zIndex:50},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-check form-switch mr-0\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input\",type:\"checkbox\",onClick:function onClick(){return setShow(function(a){return!a;});},id:\"flexSwitchCheckChecked\",checked:show}),/*#__PURE__*/_jsx(\"label\",{className:\"form-check-label\",htmlFor:\"flexSwitchCheckChecked\",children:\"Settings\"})]}),show&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Row,{className:\"mb-2\",children:[/*#__PURE__*/_jsxs(Form.Group,{className:\" col-4 mb-0\",controlId:\"subtitle-file\",children:[/*#__PURE__*/_jsx(Form.Label,{className:\"btn btn-primary\",children:\"Load Image\"}),/*#__PURE__*/_jsx(Form.Control,{readOnly:true,onChange:getLocalImage(showImage),type:\"file\",style:{visibility:\"hidden\",height:\"0px\"},placeholder:\"Image\"})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\" col-4 mb-0\",controlId:\"image-file\",children:[/*#__PURE__*/_jsx(Form.Label,{className:\"btn btn-primary\",children:\"Load SubTitle\"}),/*#__PURE__*/_jsx(Form.Control,{readOnly:true,onChange:getLocalSubtitle(updateSubtitleFile),type:\"file\",style:{visibility:\"hidden\",height:\"0px\"},placeholder:\"Image\"})]}),/*#__PURE__*/_jsx(Button,{className:\" col-2\",onClick:handleClearAll,variant:\"danger\",children:\"Clear All\"}),/*#__PURE__*/_jsx(InputSettings,{className:\"mt-2 col-12\",value:(image===null||image===void 0?void 0:image.includes(\"base64\"))?\"File\":image,placeholder:\"Image Link\",onChange:function onChange(d){setImage(function(data){return d===\"File\"?data:d;});}})]}),/*#__PURE__*/_jsxs(Row,{style:{alignItems:\"flex-end\"},children:[/*#__PURE__*/_jsxs(Form.Group,{className:\" col-3 mb-0\",controlId:\"formPage\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Page\"}),/*#__PURE__*/_jsx(Form.Control,{value:page,onChange:function onChange(e){return setPage(e.target.value);},placeholder:\"Page\"})]}),/*#__PURE__*/_jsx(Button,{className:\" col-2\",onClick:addNewPage,disabled:!isNewPage,variant:\"primary\",children:\"Add page\"}),/*#__PURE__*/_jsxs(Form.Group,{className:\" col-3 mb-0\",controlId:\"formIndex\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Index\"}),/*#__PURE__*/_jsx(Form.Control,{value:index,onChange:function onChange(e){return setIndex(e.target.value);},type:\"number\",min:\"0\",max:(_sub$String=sub[String(page)])===null||_sub$String===void 0?void 0:_sub$String.length,step:\"1\",placeholder:\"index\"})]}),/*#__PURE__*/_jsx(Button,{className:\" col-2\",onClick:addNewText,variant:\"primary\",children:\"Add Text\"})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Form.Group,{className:\" col-3\",controlId:\"formX\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"X axis\"}),/*#__PURE__*/_jsx(Form.Control,{value:x,onChange:function onChange(e){return setX(e.target.value);},type:\"number\",min:\"0\",max:\"100\",step:\"0.1\",placeholder:\"X\"})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\" col-3\",controlId:\"formY\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Y axis\"}),/*#__PURE__*/_jsx(Form.Control,{value:y,onChange:function onChange(e){return setY(e.target.value);},type:\"number\",min:\"0\",max:\"100\",step:\"0.1\",placeholder:\"Y\"})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\" col-3\",controlId:\"formY\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Size\"}),/*#__PURE__*/_jsx(Form.Control,{value:size,onChange:function onChange(e){return setSize(e.target.value);},type:\"number\",min:\"0\",max:\"100\",step:\"0.1\",placeholder:\"size\"})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\" col-3\",controlId:\"formWidth\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Width\"}),/*#__PURE__*/_jsx(Form.Control,{value:width,onChange:function onChange(e){return setWidth(e.target.value);},type:\"number\",min:\"0\",max:\"100\",step:\"0.1\",placeholder:\"width\"})]})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Form.Group,{className:\" col-8\",controlId:\"formText\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Text\"}),/*#__PURE__*/_jsx(Form.Control,{value:subText,onChange:function onChange(e){return setSubText(e.target.value);},type:\"text\",placeholder:\"width\"})]}),Object.keys(style).length>0&&/*#__PURE__*/_jsx(DropdownButton,{className:\"col-4\",variant:\"secondary\",id:\"dropdown-basic-button\",title:\"Styles\",children:Object.keys(style).length>0&&((_Object$keys=Object.keys(style))===null||_Object$keys===void 0?void 0:_Object$keys.map(function(styleProp){return/*#__PURE__*/_jsx(Dropdown.Item,{onClick:function onClick(){return handleRemoveStyle(styleProp);},children:\"\".concat(styleProp.replaceAll(\"_\",\" \"),\" : \").concat(style[styleProp])},styleProp);}))})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Form.Group,{className:\" col-4\",controlId:\"formKeyStyle\",children:/*#__PURE__*/_jsx(Form.Control,{value:keyStyle,onChange:function onChange(e){return setKeyStyle(e.target.value);},type:\"text\",placeholder:\"key\"})}),/*#__PURE__*/_jsx(Form.Group,{className:\" col-4\",controlId:\"formValueStyle\",children:/*#__PURE__*/_jsx(Form.Control,{value:valueStyle,onChange:function onChange(e){return setValueStyle(e.target.value);},type:\"text\",placeholder:\"value\"})}),/*#__PURE__*/_jsx(Button,{style:{height:\"100%\"},className:\"p-2 col-4 btn-secondary\",onClick:handleAddStyle,children:\"Add Style\"})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Form.Group,{className:\" col-6\",controlId:\"formDownload\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Download Subtitle\"}),/*#__PURE__*/_jsx(Form.Control,{value:dowloadFileName,onChange:function onChange(e){return setDowloadFileName(e.target.value);},placeholder:\"Download Subtitle\"})]}),/*#__PURE__*/_jsxs(Col,{className:\" col-6\",children:[/*#__PURE__*/_jsx(Button,{className:\" col-12 mb-2\",disabled:!dowloadFileName,onClick:function onClick(){return download(parseObjectToPSRT(sub),\"\".concat(dowloadFileName,\".psrt\"),\"*.psrt\");},variant:\"primary\",children:\"(.psrt)\"}),/*#__PURE__*/_jsx(Button,{className:\" col-12\",disabled:!dowloadFileName,onClick:function onClick(){return download(JSON.stringify(sub),\"\".concat(dowloadFileName,\".json\"),\"*.json\");},variant:\"primary\",children:\"(.json)\"})]})]})]})]});};var InputSettings=function InputSettings(_ref4){var placeholder=_ref4.placeholder,value=_ref4.value,_onChange=_ref4.onChange,_ref4$className=_ref4.className,className=_ref4$className===void 0?\"\":_ref4$className,otherProps=_objectWithoutProperties(_ref4,[\"placeholder\",\"value\",\"onChange\",\"className\"]);return/*#__PURE__*/_jsx(InputGroup,{className:\"mb-3 \"+className,children:/*#__PURE__*/_jsx(FormControl,_objectSpread({placeholder:placeholder,\"aria-label\":placeholder,\"aria-describedby\":\"basic-addon1\",onChange:function onChange(evt){return _onChange(evt.target.value);},value:value},otherProps))});};function download(data,filename,type){var file=new Blob([data],{type:type});if(window.navigator.msSaveOrOpenBlob)// IE10+\nwindow.navigator.msSaveOrOpenBlob(file,filename);else{// Others\nvar a=document.createElement(\"a\"),url=URL.createObjectURL(file);a.href=url;a.download=filename;document.body.appendChild(a);a.click();setTimeout(function(){document.body.removeChild(a);window.URL.revokeObjectURL(url);},0);}}var getLocalImage=function getLocalImage(callback){return function(evt){var tgt=evt.target;var files=tgt.files;// FileReader support\nif(FileReader&&files&&files.length){var _fr=new FileReader();_fr.onload=function(){return callback(_fr);};_fr.readAsDataURL(files[0]);}};};var getLocalSubtitle=function getLocalSubtitle(callback){return function(evt){var tgt=evt.target;var files=tgt.files;// FileReader support\nif(FileReader&&files&&files.length){var _fr2=new FileReader();_fr2.onload=function(){return callback(_fr2);};_fr2.readAsText(files[0]);}};};export default EditSub;","map":{"version":3,"sources":["/home/intelie/Documents/srt2/src/cmponents/EditSub.tsx"],"names":["React","useEffect","useState","Form","Button","DropdownButton","Dropdown","Row","Col","InputGroup","FormControl","parseObjectToPSRT","parsePSRTToObject","BG_SELECT_COLOR","EditSub","sub","setSub","defaultPage","page","setDefaultPage","setPage","setImage","image","setImageStyle","setEditStyles","isNewPage","setIsNewPage","index","setIndex","x","setX","y","setY","width","setWidth","size","setSize","subText","setSubText","show","setShow","style","setStyle","keyStyle","setKeyStyle","valueStyle","setValueStyle","dowloadFileName","setDowloadFileName","reduce","p","c","lastIndex","setLastIndex","handleChangeSub","backgroundColor","Object","keys","includes","data","map","txt","parseInt","String","parseFloat","text","error","console","log","updateSubInfos","newSub","_sub","find","a","oldX","oldY","oldW","oldS","old","addNewText","addNewPage","updateSubtitleFile","fr","localStorage","setItem","result","showImage","handleAddStyle","handleRemoveStyle","key","newStyles","handleClearAll","page1","position","left","overflowY","overflowX","zIndex","getLocalImage","visibility","height","getLocalSubtitle","d","alignItems","e","target","value","length","styleProp","replaceAll","download","JSON","stringify","InputSettings","placeholder","onChange","className","otherProps","evt","filename","type","file","Blob","window","navigator","msSaveOrOpenBlob","document","createElement","url","URL","createObjectURL","href","body","appendChild","click","setTimeout","removeChild","revokeObjectURL","callback","tgt","files","FileReader","onload","readAsDataURL","readAsText"],"mappings":"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","sourcesContent":["/* eslint-disable react/jsx-no-undef */\nimport React, { useEffect, useState } from \"react\";\nimport {\n  Form,\n  Button,\n  DropdownButton,\n  Dropdown,\n  Row,\n  Col,\n  InputGroup,\n  FormControl,\n} from \"react-bootstrap\";\nimport {\n  parseObjectToPSRT,\n  parsePSRTFileToObject,\n  parsePSRTToObject,\n} from \"../service/subtitle\";\nimport { ImageStyle } from \"./ImageSubTittle\";\n\nconst BG_SELECT_COLOR = \"#0f04\";\n//import DragScaleBar from 'react-drag-scale-bar'\n// import { Container } from './styles';\ntype TypeUseState<T> = (a: T | ((a: T) => T)) => void;\ntype TypeSub = {\n  [page: string]: {\n    x: number;\n    y: number;\n    index: number;\n    width: number;\n    size: number;\n    text: string;\n    style: React.CSSProperties;\n  }[];\n};\nconst EditSub: React.FC<{\n  sub: TypeSub;\n  setSub: TypeUseState<TypeSub>;\n  page?: string;\n  setPage: TypeUseState<string>;\n  setImage: TypeUseState<string>;\n  image?: string;\n  setImageStyle: TypeUseState<React.CSSProperties | string>;\n  setEditStyles: TypeUseState<ImageStyle>;\n}> = ({\n  sub,\n  setSub,\n  page: defaultPage,\n  setPage: setDefaultPage,\n  setImage,\n  image,\n  setImageStyle,\n  setEditStyles,\n}) => {\n  const [page, setPage] = useState(defaultPage || \"page1\");\n  const [isNewPage, setIsNewPage] = useState(false);\n  const [index, setIndex] = useState<string | number>(1);\n  const [x, setX] = useState<string | number>(0);\n  const [y, setY] = useState<string | number>(0);\n  const [width, setWidth] = useState<string | number>(0);\n  const [size, setSize] = useState<string | number>(0);\n  const [subText, setSubText] = useState(\"\");\n  const [show, setShow] = useState(true);\n  const [style, setStyle] = useState<{ [cssAttr: string]: string }>({});\n  const [keyStyle, setKeyStyle] = useState<string>(\"\");\n  const [valueStyle, setValueStyle] = useState<string>(\"\");\n  const [dowloadFileName, setDowloadFileName] = useState(\"sub\");\n  \n  const [lastIndex, setLastIndex] = useState(\n    sub[`${page}`]?.reduce((p, c) => (c.index > p ? c.index : p), 0) + 1\n  );\n\n  const handleChangeSub = () => {\n    setEditStyles({\n      [page]: {\n        [index]: {\n          backgroundColor: BG_SELECT_COLOR,\n        },\n      },\n    });\n    if (Object.keys(sub).includes(page)) {\n      try {\n        setSub((data) => ({\n          ...data,\n          [page]: [\n            ...data[page]?.map((txt) => {\n              if (txt.index === parseInt(String(index))) {\n                return {\n                  ...txt,\n                  x: parseFloat(x),\n                  y: parseFloat(y),\n                  width: parseFloat(width),\n                  size: parseFloat(size),\n                  text: subText,\n                  style: {\n                    ...style,\n                  },\n                };\n              } else {\n                return txt;\n              }\n            }),\n          ],\n        }));\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  };\n\n  useEffect(() => {\n    //console.log(sub);\n    handleChangeSub();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [x, y, width, size, subText, style, defaultPage]);\n\n  const updateSubInfos = (newSub?: TypeSub) => {\n    const _sub = newSub || sub;\n    if (page) {\n      const text = _sub[page]?.find((a) => a.index === parseInt(String(index)));\n      setX((oldX) => text?.x || oldX);\n      setY((oldY) => text?.y || oldY);\n      setWidth((oldW) => text?.width || oldW);\n      setSize((oldS) => text?.size || oldS);\n      setSubText(text?.text || \"\");\n      setStyle((old) => (text?.style ? { ...text?.style } : { ...old }));\n    }\n  };\n\n  const addNewText = () => {\n    setSub((data) => ({\n      ...data,\n      [page]: [\n        ...data[page],\n        {\n          index: parseInt(String(lastIndex)),\n          x: parseFloat(String(x)),\n          y: parseFloat(String(y)),\n          width: parseFloat(String(width)),\n          size: parseFloat(String(size)),\n          text: subText,\n          style: {\n            ...style,\n            backgroundColor: BG_SELECT_COLOR,\n          },\n        },\n      ],\n    }));\n\n    setIndex(lastIndex);\n    setLastIndex((old) => old + 1);\n  };\n\n  const addNewPage = () => {\n    if (isNewPage) {\n      setSub({\n        ...sub,\n        [page]: [\n          {\n            index: parseInt(String(0)),\n            x: parseFloat(String(x)),\n            y: parseFloat(String(y)),\n            width: parseFloat(String(width)),\n            size: parseFloat(String(size)),\n            text: subText,\n            style: {\n              ...style,\n              backgroundColor: BG_SELECT_COLOR,\n            },\n          },\n        ],\n      });\n      updateSubInfos(sub);\n\n      setIndex(0);\n      setLastIndex(1);\n      setDefaultPage(page);\n      updateSubInfos();\n    }\n  };\n\n  const updateSubtitleFile = (fr: FileReader) => {\n    localStorage.setItem(\"lastPSRT\", String(fr.result));\n    const newSub: TypeSub = parsePSRTToObject(String(fr.result));\n    setSub(newSub);\n    setLastIndex(\n      newSub[page]?.reduce((p, { index }) => (index > p ? index : p), 0) + 1\n    );\n    updateSubInfos(newSub);\n  };\n  const showImage = (fr: FileReader) => {\n    localStorage.setItem(\"lastImage\", String(fr.result));\n    setImage(String(fr.result));\n  };\n\n  const handleAddStyle = () => {\n    setStyle((old) => ({ ...old, [keyStyle]: valueStyle }));\n    setValueStyle(\"\");\n    setKeyStyle(\"\");\n  };\n\n  const handleRemoveStyle = (key: string) => {\n    setValueStyle(style[key]);\n    setKeyStyle(key);\n    const newStyles = { ...style };\n\n    delete newStyles[key];\n\n    setStyle(newStyles);\n  };\n\n  const handleClearAll = () => {\n    const newSub = {\n      page1: [],\n    };\n\n    setSub(newSub);\n    setPage(\"page1\");\n    setIndex(0);\n    setLastIndex(0);\n  };\n\n  useEffect(() => {\n    updateSubInfos();\n  }, [index, page]);\n\n  useEffect(() => {\n    setIsNewPage(!Object.keys(sub).includes(page));\n    Object.keys(sub).includes(page) && setDefaultPage(page);\n    setLastIndex(\n      sub[page]?.reduce((p, { index }) => (index > p ? index : p), 0) + 1\n    );\n  }, [page]);\n\n  return (\n    <Form\n      style={{\n        position: \"fixed\",\n        width: \"500px\",\n        left: 0,\n        overflowY: \"auto\",\n        overflowX: \"hidden\",\n        zIndex: 50,\n      }}\n    >\n      <div className={`form-check form-switch mr-0`}>\n        <input\n          className=\"form-check-input\"\n          type=\"checkbox\"\n          onClick={() => setShow((a) => !a)}\n          id=\"flexSwitchCheckChecked\"\n          checked={show}\n        />\n        <label className=\"form-check-label\" htmlFor=\"flexSwitchCheckChecked\">\n          Settings\n        </label>\n      </div>\n      {show && (\n        <div>\n          <Row className=\"mb-2\">\n            <Form.Group className=\" col-4 mb-0\" controlId=\"subtitle-file\">\n              <Form.Label className=\"btn btn-primary\">Load Image</Form.Label>\n              <Form.Control\n                readOnly\n                onChange={getLocalImage(showImage)}\n                type=\"file\"\n                style={{ visibility: \"hidden\", height: \"0px\" }}\n                placeholder=\"Image\"\n              />\n            </Form.Group>\n\n            <Form.Group className=\" col-4 mb-0\" controlId=\"image-file\">\n              <Form.Label className=\"btn btn-primary\">Load SubTitle</Form.Label>\n              <Form.Control\n              readOnly\n                onChange={getLocalSubtitle(updateSubtitleFile)}\n                type=\"file\"\n                style={{ visibility: \"hidden\", height: \"0px\" }}\n                placeholder=\"Image\"\n              />\n            </Form.Group>\n\n            <Button\n              className=\" col-2\"\n              onClick={handleClearAll}\n              variant=\"danger\"\n            >\n              Clear All\n            </Button>\n            <InputSettings\n              className=\"mt-2 col-12\"\n              value={image?.includes(\"base64\") ? \"File\" : image}\n              placeholder=\"Image Link\"\n              onChange={(d: string) => {\n                setImage((data) => (d === \"File\" ? data : d));\n              }}\n            />\n          </Row>\n\n          <Row style={{ alignItems: \"flex-end\" }}>\n            <Form.Group className=\" col-3 mb-0\" controlId=\"formPage\">\n              <Form.Label>Page</Form.Label>\n              <Form.Control\n                value={page}\n                onChange={(e) => setPage(e.target.value)}\n                placeholder=\"Page\"\n              />\n            </Form.Group>\n\n            <Button\n              className=\" col-2\"\n              onClick={addNewPage}\n              disabled={!isNewPage}\n              variant=\"primary\"\n            >\n              Add page\n            </Button>\n\n            <Form.Group className=\" col-3 mb-0\" controlId=\"formIndex\">\n              <Form.Label>Index</Form.Label>\n              <Form.Control\n                value={index}\n                onChange={(e) => setIndex(e.target.value)}\n                type=\"number\"\n                min=\"0\"\n                max={sub[String(page)]?.length}\n                step=\"1\"\n                placeholder=\"index\"\n              />\n            </Form.Group>\n\n            <Button className=\" col-2\" onClick={addNewText} variant=\"primary\">\n              Add Text\n            </Button>\n          </Row>\n          <Row>\n            <Form.Group className=\" col-3\" controlId=\"formX\">\n              <Form.Label>X axis</Form.Label>\n              <Form.Control\n                value={x}\n                onChange={(e) => setX(e.target.value)}\n                type=\"number\"\n                min=\"0\"\n                max=\"100\"\n                step=\"0.1\"\n                placeholder=\"X\"\n              />\n            </Form.Group>\n\n            <Form.Group className=\" col-3\" controlId=\"formY\">\n              <Form.Label>Y axis</Form.Label>\n              <Form.Control\n                value={y}\n                onChange={(e) => setY(e.target.value)}\n                type=\"number\"\n                min=\"0\"\n                max=\"100\"\n                step=\"0.1\"\n                placeholder=\"Y\"\n              />\n            </Form.Group>\n\n            <Form.Group className=\" col-3\" controlId=\"formY\">\n              <Form.Label>Size</Form.Label>\n              <Form.Control\n                value={size}\n                onChange={(e) => setSize(e.target.value)}\n                type=\"number\"\n                min=\"0\"\n                max=\"100\"\n                step=\"0.1\"\n                placeholder=\"size\"\n              />\n            </Form.Group>\n            <Form.Group className=\" col-3\" controlId=\"formWidth\">\n              <Form.Label>Width</Form.Label>\n              <Form.Control\n                value={width}\n                onChange={(e) => setWidth(e.target.value)}\n                type=\"number\"\n                min=\"0\"\n                max=\"100\"\n                step=\"0.1\"\n                placeholder=\"width\"\n              />\n            </Form.Group>\n          </Row>\n          <Row>\n            <Form.Group className=\" col-8\" controlId=\"formText\">\n              <Form.Label>Text</Form.Label>\n              <Form.Control\n                value={subText}\n                onChange={(e) => setSubText(e.target.value)}\n                type=\"text\"\n                placeholder=\"width\"\n              />\n            </Form.Group>\n            {Object.keys(style).length > 0 && (\n              <DropdownButton\n                className=\"col-4\"\n                variant=\"secondary\"\n                id=\"dropdown-basic-button\"\n                title=\"Styles\"\n              >\n                {Object.keys(style).length > 0 &&\n                  Object.keys(style)?.map((styleProp) => (\n                    <Dropdown.Item\n                      onClick={() => handleRemoveStyle(styleProp)}\n                      key={styleProp}\n                    >\n                      {`${styleProp.replaceAll(\"_\", \" \")} : ${\n                        style[styleProp]\n                      }`}\n                    </Dropdown.Item>\n                  ))}\n              </DropdownButton>\n            )}\n          </Row>\n          <Row>\n            <Form.Group className=\" col-4\" controlId=\"formKeyStyle\">\n              <Form.Control\n                value={keyStyle}\n                onChange={(e) => setKeyStyle(e.target.value)}\n                type=\"text\"\n                placeholder=\"key\"\n              />\n            </Form.Group>\n            <Form.Group className=\" col-4\" controlId=\"formValueStyle\">\n              <Form.Control\n                value={valueStyle}\n                onChange={(e) => setValueStyle(e.target.value)}\n                type=\"text\"\n                placeholder=\"value\"\n              />\n            </Form.Group>\n\n            <Button\n              style={{ height: \"100%\" }}\n              className=\"p-2 col-4 btn-secondary\"\n              onClick={handleAddStyle}\n            >\n              Add Style\n            </Button>\n          </Row>\n\n          <Row>\n            <Form.Group className=\" col-6\" controlId=\"formDownload\">\n              <Form.Label>Download Subtitle</Form.Label>\n              <Form.Control\n                value={dowloadFileName}\n                onChange={(e) => setDowloadFileName(e.target.value)}\n                placeholder=\"Download Subtitle\"\n              />\n            </Form.Group>\n            <Col className=\" col-6\">\n              <Button\n                className=\" col-12 mb-2\"\n                disabled={!dowloadFileName}\n                onClick={() =>\n                  download(\n                    parseObjectToPSRT(sub),\n                    `${dowloadFileName}.psrt`,\n                    \"*.psrt\"\n                  )\n                }\n                variant=\"primary\"\n              >\n                (.psrt)\n              </Button>\n              <Button\n                className=\" col-12\"\n                disabled={!dowloadFileName}\n                onClick={() =>\n                  download(\n                    JSON.stringify(sub),\n                    `${dowloadFileName}.json`,\n                    \"*.json\"\n                  )\n                }\n                variant=\"primary\"\n              >\n                (.json)\n              </Button>\n            </Col>\n          </Row>\n        </div>\n      )}\n    </Form>\n  );\n};\n\nconst InputSettings = ({\n  placeholder,\n  value,\n  onChange,\n  className = \"\",\n  ...otherProps\n}) => {\n  return (\n    <InputGroup className={\"mb-3 \" + className}>\n      <FormControl\n        placeholder={placeholder}\n        aria-label={placeholder}\n        aria-describedby=\"basic-addon1\"\n        onChange={(evt) => onChange(evt.target.value)}\n        value={value}\n        {...otherProps}\n      />\n    </InputGroup>\n  );\n};\n\nfunction download(data, filename, type) {\n  var file = new Blob([data], { type: type });\n  if (window.navigator.msSaveOrOpenBlob)\n    // IE10+\n    window.navigator.msSaveOrOpenBlob(file, filename);\n  else {\n    // Others\n    var a = document.createElement(\"a\"),\n      url = URL.createObjectURL(file);\n    a.href = url;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n    setTimeout(function () {\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n    }, 0);\n  }\n}\n\nconst getLocalImage = (callback: (fr: FileReader) => any) => (evt) => {\n  let tgt = evt.target;\n  let files = tgt.files;\n\n  // FileReader support\n  if (FileReader && files && files.length) {\n    let fr = new FileReader();\n    fr.onload = () => callback(fr);\n    fr.readAsDataURL(files[0]);\n  }\n};\n\nconst getLocalSubtitle = (callback: (fr: FileReader) => any) => (evt) => {\n  let tgt = evt.target;\n  let files = tgt.files;\n\n  // FileReader support\n  if (FileReader && files && files.length) {\n    let fr = new FileReader();\n    fr.onload = () => callback(fr);\n    fr.readAsText(files[0]);\n  }\n};\n\nexport default EditSub;\n"]},"metadata":{},"sourceType":"module"}