{"ast":null,"code":"export const parsePSRTToObject = file => {\n  let out = {};\n  let currentPage = \"\";\n  let rawFile = new XMLHttpRequest();\n  rawFile.open(\"GET\", file, false);\n\n  rawFile.onreadystatechange = function () {\n    if (rawFile.readyState === 4) {\n      if (rawFile.status === 200 || rawFile.status == 0) {\n        let allText = rawFile.responseText;\n        let i = 0;\n        let lastIndex = 0;\n        allText.split(\"\\n\").map(line => {\n          if (line.includes(\"$START\")) {\n            currentPage = line.substring(6).trim();\n            out[line.substring(6).trim()] = [];\n          } else if (line.includes(\"$END\")) {\n            currentPage = \"\";\n          } else if (line.includes(\">>\")) {\n            var _out$currentPage, _clearLine$split;\n\n            const clearLine = line.substring(2);\n            const [x, y, s, w] = clearLine.split(\" \")[0].split(\"-\");\n            (_out$currentPage = out[currentPage]) === null || _out$currentPage === void 0 ? void 0 : _out$currentPage.push({\n              index: clearLine.split(\" \")[2] ? parseInt(clearLine.split(\" \")[2]) : lastIndex + i,\n              x: parseFloat(x),\n              y: parseFloat(y),\n              size: parseFloat(s),\n              width: parseFloat(w),\n              style: JSON.parse((_clearLine$split = clearLine.split(\" \")) === null || _clearLine$split === void 0 ? void 0 : _clearLine$split[1])\n            });\n            lastIndex = clearLine.split(\" \")[2] ? parseInt(clearLine.split(\" \")[2]) : lastIndex;\n            i += 1;\n          } else if (line.length > 1) {\n            var _out$currentPage2;\n\n            if (((_out$currentPage2 = out[currentPage]) === null || _out$currentPage2 === void 0 ? void 0 : _out$currentPage2.length) > 0) {\n              var _out$currentPage3;\n\n              out[currentPage][((_out$currentPage3 = out[currentPage]) === null || _out$currentPage3 === void 0 ? void 0 : _out$currentPage3.length) - 1].text = line;\n            }\n          }\n        });\n      }\n    }\n  };\n\n  rawFile.send(null);\n  return out;\n};\nexport const parseObjectToPSRT = sub => {\n  let out = \"\";\n  Object.keys(sub).map(page => {\n    out += `$START ${page}\\n`;\n    sub[page].map(({\n      x,\n      y,\n      size,\n      width,\n      text,\n      style,\n      index\n    }, i) => {\n      out += `${x}-${y}-${size}-${width} ${JSON.stringify(style)} ${index || i}\\n`;\n      out += `${text}\\n\\n`;\n    });\n    out += `$END ${page}\\n\\n`;\n  });\n  return out;\n};","map":{"version":3,"sources":["/home/intelie/Documents/srt2/src/service/subtitle.ts"],"names":["parsePSRTToObject","file","out","currentPage","rawFile","XMLHttpRequest","open","onreadystatechange","readyState","status","allText","responseText","i","lastIndex","split","map","line","includes","substring","trim","clearLine","x","y","s","w","push","index","parseInt","parseFloat","size","width","style","JSON","parse","length","text","send","parseObjectToPSRT","sub","Object","keys","page","stringify"],"mappings":"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","sourcesContent":["export const parsePSRTToObject = (\n  file: string\n): {\n  [page: string]: {\n    x: number;\n    y: number;\n    index: number;\n    width: number;\n    size: number;\n    text: string;\n    style: React.CSSProperties;\n  }[];\n} => {\n  let out: { [k: string]: any } = {};\n  let currentPage = \"\";\n  let rawFile = new XMLHttpRequest();\n  rawFile.open(\"GET\", file, false);\n  rawFile.onreadystatechange = function () {\n    if (rawFile.readyState === 4) {\n      if (rawFile.status === 200 || rawFile.status == 0) {\n        let allText = rawFile.responseText;\n        let i = 0;\n        let lastIndex = 0;\n        allText.split(\"\\n\").map((line) => {\n          if (line.includes(\"$START\")) {\n            currentPage = line.substring(6).trim();\n            out[line.substring(6).trim()] = [];\n          } else if (line.includes(\"$END\")) {\n            currentPage = \"\";\n          } else if (line.includes(\">>\")) {\n            const clearLine = line.substring(2);\n            const [x, y, s, w] = clearLine.split(\" \")[0].split(\"-\");\n            out[currentPage]?.push({\n              index: clearLine.split(\" \")[2]\n                ? parseInt(clearLine.split(\" \")[2])\n                : lastIndex + i,\n              x: parseFloat(x),\n              y: parseFloat(y),\n              size: parseFloat(s),\n              width: parseFloat(w),\n              style: JSON.parse(clearLine.split(\" \")?.[1]),\n            });\n            lastIndex = clearLine.split(\" \")[2]\n              ? parseInt(clearLine.split(\" \")[2])\n              : lastIndex;\n\n            i += 1;\n          } else if (line.length > 1) {\n            if (out[currentPage]?.length > 0) {\n              out[currentPage][out[currentPage]?.length - 1].text = line;\n            }\n          }\n        });\n      }\n    }\n  };\n\n  rawFile.send(null);\n\n  return out;\n};\n\nexport const parseObjectToPSRT = (sub: {\n  [page: string]: {\n    x: number;\n    y: number;\n    width: number;\n    size: number;\n    text: string;\n    index: number;\n    style: React.CSSProperties;\n  }[];\n}): string => {\n  let out = \"\";\n\n  Object.keys(sub).map((page) => {\n    out += `$START ${page}\\n`;\n    sub[page].map(({ x, y, size, width, text, style, index }, i) => {\n      out += `${x}-${y}-${size}-${width} ${JSON.stringify(style)} ${\n        index || i\n      }\\n`;\n      out += `${text}\\n\\n`;\n    });\n    out += `$END ${page}\\n\\n`;\n  });\n  return out;\n};\n"]},"metadata":{},"sourceType":"module"}