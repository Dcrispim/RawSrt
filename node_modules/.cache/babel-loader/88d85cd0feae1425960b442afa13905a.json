{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _defineProperty from\"/home/intelie/Documents/srt2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _toConsumableArray from\"/home/intelie/Documents/srt2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/home/intelie/Documents/srt2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/intelie/Documents/srt2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* eslint-disable react/jsx-no-undef */import React,{useEffect,useState}from\"react\";import{Form,Button,DropdownButton,Dropdown,Row}from\"react-bootstrap\";import{parseObjectToPSRT,parsePSRTToObject}from\"../service/subtitle\";//import DragScaleBar from 'react-drag-scale-bar'\n// import { Container } from './styles';\nvar EditSub=function EditSub(_ref){var _sub$,_sub$String,_Object$keys;var sub=_ref.sub,setSub=_ref.setSub,defaultPage=_ref.page,setDefaultPage=_ref.setPage,setImage=_ref.setImage,setImageStyle=_ref.setImageStyle;var _useState=useState(defaultPage||\"page1\"),_useState2=_slicedToArray(_useState,2),page=_useState2[0],setPage=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isNewPage=_useState4[0],setIsNewPage=_useState4[1];var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),index=_useState6[0],setIndex=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),x=_useState8[0],setX=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),y=_useState10[0],setY=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),width=_useState12[0],setWidth=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),size=_useState14[0],setSize=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),subText=_useState16[0],setSubText=_useState16[1];var _useState17=useState(true),_useState18=_slicedToArray(_useState17,2),show=_useState18[0],setShow=_useState18[1];var _useState19=useState({}),_useState20=_slicedToArray(_useState19,2),style=_useState20[0],setStyle=_useState20[1];var _useState21=useState(\"\"),_useState22=_slicedToArray(_useState21,2),keyStyle=_useState22[0],setKeyStyle=_useState22[1];var _useState23=useState(\"\"),_useState24=_slicedToArray(_useState23,2),valueStyle=_useState24[0],setValueStyle=_useState24[1];var _useState25=useState(sub?sub:{}),_useState26=_slicedToArray(_useState25,2),clearSub=_useState26[0],setClearSub=_useState26[1];var _useState27=useState(((_sub$=sub[\"\".concat(page)])===null||_sub$===void 0?void 0:_sub$.reduce(function(p,c){return c.index>p?c.index:p;},0))+1),_useState28=_slicedToArray(_useState27,2),lastIndex=_useState28[0],setLastIndex=_useState28[1];var handleChangeSub=function handleChangeSub(){console.log(Object.keys(clearSub));if(Object.keys(clearSub).includes(page)){try{setSub(function(data){var _data$page;return _objectSpread(_objectSpread({},data),{},_defineProperty({},page,_toConsumableArray((_data$page=data[page])===null||_data$page===void 0?void 0:_data$page.map(function(txt){console.log(txt.index,index);if(txt.index===parseInt(String(index))){return _objectSpread(_objectSpread({},txt),{},{x:parseFloat(x),y:parseFloat(y),width:parseFloat(width),size:parseFloat(size),text:subText,style:_objectSpread(_objectSpread({},style),{},{backgroundColor:\"#0f0\"})});}else{if(txt.style.backgroundColor===\"#0f0\"){delete txt.style.backgroundColor;}return txt;}}))));});setClearSub(function(data){var _clearSub$page;return _objectSpread(_objectSpread({},data),{},_defineProperty({},page,_toConsumableArray(clearSub===null||clearSub===void 0?void 0:(_clearSub$page=clearSub[page])===null||_clearSub$page===void 0?void 0:_clearSub$page.map(function(txt){if(txt.index===parseInt(String(index))){return _objectSpread(_objectSpread({},txt),{},{x:parseFloat(x),y:parseFloat(y),width:parseFloat(width),size:parseFloat(size),text:subText,style:_objectSpread({},style)});}else{return _objectSpread({},txt);}}))));});}catch(error){console.log(error);}}};useEffect(function(){//console.log(sub);\nhandleChangeSub();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[x,y,width,size,subText,style,defaultPage]);var updateSubInfos=function updateSubInfos(newSub){var _sub=newSub||sub;if(page){var _sub$page;var text=(_sub$page=_sub[page])===null||_sub$page===void 0?void 0:_sub$page.find(function(a){return a.index===parseInt(String(index));});setX(function(oldX){return(text===null||text===void 0?void 0:text.x)||oldX;});setY(function(oldY){return(text===null||text===void 0?void 0:text.y)||oldY;});setWidth(function(oldW){return(text===null||text===void 0?void 0:text.width)||oldW;});setSize(function(oldS){return(text===null||text===void 0?void 0:text.size)||oldS;});setSubText((text===null||text===void 0?void 0:text.text)||\"\");setStyle(function(old){return(text===null||text===void 0?void 0:text.style)?_objectSpread({},text===null||text===void 0?void 0:text.style):_objectSpread({},old);});}};var addNewText=function addNewText(){setSub(function(data){return _objectSpread(_objectSpread({},data),{},_defineProperty({},page,[].concat(_toConsumableArray(data[page]),[{index:parseInt(String(lastIndex)),x:parseFloat(String(x)),y:parseFloat(String(y)),width:parseFloat(String(width)),size:parseFloat(String(size)),text:subText,style:_objectSpread(_objectSpread({},style),{},{backgroundColor:\"#0f0\"})}])));});setClearSub(function(data){return _objectSpread(_objectSpread({},data),{},_defineProperty({},page,[].concat(_toConsumableArray(data[page]),[{index:parseInt(String(lastIndex)),x:parseFloat(String(x)),y:parseFloat(String(y)),width:parseFloat(String(width)),size:parseFloat(String(size)),text:subText,style:_objectSpread({},style)}])));});setIndex(lastIndex);setLastIndex(function(old){return old+1;});};var addNewPage=function addNewPage(){if(isNewPage){setSub(_objectSpread(_objectSpread({},clearSub),{},_defineProperty({},page,[{index:parseInt(String(0)),x:parseFloat(String(x)),y:parseFloat(String(y)),width:parseFloat(String(width)),size:parseFloat(String(size)),text:subText,style:_objectSpread(_objectSpread({},style),{},{backgroundColor:\"#0f0\"})}])));setClearSub(_objectSpread(_objectSpread({},clearSub),{},_defineProperty({},page,[{index:parseInt(String(0)),x:parseFloat(String(x)),y:parseFloat(String(y)),width:parseFloat(String(width)),size:parseFloat(String(size)),text:subText,style:_objectSpread({},style)}])));updateSubInfos(sub);setIndex(0);setLastIndex(1);setDefaultPage(page);updateSubInfos();}};var updateSubtitleFile=function updateSubtitleFile(fr){var newSub=parsePSRTToObject(String(fr.result));setSub(newSub);setClearSub(newSub);setLastIndex(newSub[page].reduce(function(p,_ref2){var index=_ref2.index;return index>p?index:p;},0)+1);updateSubInfos(newSub);};var showImage=function showImage(fr){return setImage(String(fr.result));};var handleAddStyle=function handleAddStyle(){setStyle(function(old){return _objectSpread(_objectSpread({},old),{},_defineProperty({},keyStyle,valueStyle));});setValueStyle(\"\");setKeyStyle(\"\");};var handleRemoveStyle=function handleRemoveStyle(key){setValueStyle(style[key]);setKeyStyle(key);var newStyles=_objectSpread({},style);delete newStyles[key];setStyle(newStyles);};var handleClearAll=function handleClearAll(){var newSub={page1:[]};setClearSub(newSub);setSub(newSub);setPage(\"page1\");setIndex(0);setLastIndex(0);};useEffect(function(){updateSubInfos();},[index,page]);useEffect(function(){var _clearSub$page2;setIsNewPage(!Object.keys(sub).includes(page));Object.keys(sub).includes(page)&&setDefaultPage(page);setLastIndex(((_clearSub$page2=clearSub[page])===null||_clearSub$page2===void 0?void 0:_clearSub$page2.reduce(function(p,_ref3){var index=_ref3.index;return index>p?index:p;},0))+1);},[page]);return/*#__PURE__*/_jsxs(Form,{style:{position:\"fixed\",width:\"500px\",left:0,overflowY:\"auto\",overflowX:\"hidden\",zIndex:50},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-check form-switch mr-0\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input\",type:\"checkbox\",onClick:function onClick(){return setShow(function(a){return!a;});},id:\"flexSwitchCheckChecked\",checked:show}),/*#__PURE__*/_jsx(\"label\",{className:\"form-check-label\",htmlFor:\"flexSwitchCheckChecked\",children:\"Settings\"})]}),show&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Row,{className:\"mb-2\",children:[/*#__PURE__*/_jsxs(Form.Group,{className:\" col-4 mb-0\",controlId:\"subtitle-file\",children:[/*#__PURE__*/_jsx(Form.Label,{className:\"btn btn-primary\",children:\"Load Image\"}),/*#__PURE__*/_jsx(Form.Control,{onChange:getLocalImage(showImage),type:\"file\",style:{visibility:\"hidden\",height:\"0px\"},placeholder:\"Image\"})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\" col-4 mb-0\",controlId:\"image-file\",children:[/*#__PURE__*/_jsx(Form.Label,{className:\"btn btn-primary\",children:\"Load SubTitle\"}),/*#__PURE__*/_jsx(Form.Control,{onChange:getLocalSubtitle(updateSubtitleFile),type:\"file\",style:{visibility:\"hidden\",height:\"0px\"},placeholder:\"Image\"})]}),/*#__PURE__*/_jsx(Button,{className:\" col-2\",onClick:handleClearAll,variant:\"danger\",children:\"Clear All\"})]}),/*#__PURE__*/_jsxs(Row,{style:{alignItems:\"flex-end\"},children:[/*#__PURE__*/_jsxs(Form.Group,{className:\" col-3 mb-0\",controlId:\"formPage\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Page\"}),/*#__PURE__*/_jsx(Form.Control,{value:page,onChange:function onChange(e){return setPage(e.target.value);},placeholder:\"Page\"})]}),/*#__PURE__*/_jsx(Button,{className:\" col-2\",onClick:addNewPage,disabled:!isNewPage,variant:\"primary\",children:\"Add page\"}),/*#__PURE__*/_jsxs(Form.Group,{className:\" col-3 mb-0\",controlId:\"formIndex\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Index\"}),/*#__PURE__*/_jsx(Form.Control,{value:index,onChange:function onChange(e){return setIndex(e.target.value);},type:\"number\",min:\"0\",max:(_sub$String=sub[String(page)])===null||_sub$String===void 0?void 0:_sub$String.length,step:\"1\",placeholder:\"index\"})]}),/*#__PURE__*/_jsx(Button,{className:\" col-2\",onClick:addNewText,variant:\"primary\",children:\"Add Text\"})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Form.Group,{className:\" col-3\",controlId:\"formX\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"X axis\"}),/*#__PURE__*/_jsx(Form.Control,{value:x,onChange:function onChange(e){return setX(e.target.value);},type:\"number\",min:\"0\",max:\"100\",step:\"0.1\",placeholder:\"X\"})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\" col-3\",controlId:\"formY\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Y axis\"}),/*#__PURE__*/_jsx(Form.Control,{value:y,onChange:function onChange(e){return setY(e.target.value);},type:\"number\",min:\"0\",max:\"100\",step:\"0.1\",placeholder:\"Y\"})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\" col-3\",controlId:\"formY\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Size\"}),/*#__PURE__*/_jsx(Form.Control,{value:size,onChange:function onChange(e){return setSize(e.target.value);},type:\"number\",min:\"0\",max:\"100\",step:\"0.1\",placeholder:\"size\"})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\" col-3\",controlId:\"formWidth\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Width\"}),/*#__PURE__*/_jsx(Form.Control,{value:width,onChange:function onChange(e){return setWidth(e.target.value);},type:\"number\",min:\"0\",max:\"100\",step:\"0.1\",placeholder:\"width\"})]})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Form.Group,{className:\" col-8\",controlId:\"formText\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Text\"}),/*#__PURE__*/_jsx(Form.Control,{value:subText,onChange:function onChange(e){return setSubText(e.target.value);},type:\"text\",placeholder:\"width\"})]}),Object.keys(style).length>0&&/*#__PURE__*/_jsx(DropdownButton,{className:\"col-4\",variant:\"secondary\",id:\"dropdown-basic-button\",title:\"Styles\",children:Object.keys(style).length>0&&((_Object$keys=Object.keys(style))===null||_Object$keys===void 0?void 0:_Object$keys.map(function(styleProp){return/*#__PURE__*/_jsx(Dropdown.Item,{onClick:function onClick(){return handleRemoveStyle(styleProp);},children:\"\".concat(styleProp.replaceAll(\"_\",\" \"),\" : \").concat(style[styleProp])},styleProp);}))})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Form.Group,{className:\" col-4\",controlId:\"formKeyStyle\",children:/*#__PURE__*/_jsx(Form.Control,{value:keyStyle,onChange:function onChange(e){return setKeyStyle(e.target.value);},type:\"text\",placeholder:\"key\"})}),/*#__PURE__*/_jsx(Form.Group,{className:\" col-4\",controlId:\"formValueStyle\",children:/*#__PURE__*/_jsx(Form.Control,{value:valueStyle,onChange:function onChange(e){return setValueStyle(e.target.value);},type:\"text\",placeholder:\"value\"})}),/*#__PURE__*/_jsx(Button,{style:{height:\"100%\"},className:\"p-2 col-4 btn-secondary\",onClick:handleAddStyle,children:\"Add Style\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return download(parseObjectToPSRT(clearSub),\"sub.psrt\",\"jpg\");},variant:\"primary\",children:\"Dowload Subtitle (.psrt)\"}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return download(JSON.stringify(clearSub),\"sub.json\",\"jpg\");},variant:\"primary\",children:\"Dowload Subtitle (.json)\"})]})]})]});};function download(data,filename,type){var file=new Blob([data],{type:type});if(window.navigator.msSaveOrOpenBlob)// IE10+\nwindow.navigator.msSaveOrOpenBlob(file,filename);else{// Others\nvar a=document.createElement(\"a\"),url=URL.createObjectURL(file);a.href=url;a.download=filename;document.body.appendChild(a);a.click();setTimeout(function(){document.body.removeChild(a);window.URL.revokeObjectURL(url);},0);}}var getLocalImage=function getLocalImage(callback){return function(evt){var tgt=evt.target;var files=tgt.files;// FileReader support\nif(FileReader&&files&&files.length){var _fr=new FileReader();_fr.onload=function(){return callback(_fr);};_fr.readAsDataURL(files[0]);}};};var getLocalSubtitle=function getLocalSubtitle(callback){return function(evt){var tgt=evt.target;var files=tgt.files;// FileReader support\nif(FileReader&&files&&files.length){var _fr2=new FileReader();_fr2.onload=function(){return callback(_fr2);};_fr2.readAsText(files[0]);}};};export default EditSub;","map":{"version":3,"sources":["/home/intelie/Documents/srt2/src/cmponents/EditSub.tsx"],"names":["React","useEffect","useState","Form","Button","DropdownButton","Dropdown","Row","parseObjectToPSRT","parsePSRTToObject","EditSub","sub","setSub","defaultPage","page","setDefaultPage","setPage","setImage","setImageStyle","isNewPage","setIsNewPage","index","setIndex","x","setX","y","setY","width","setWidth","size","setSize","subText","setSubText","show","setShow","style","setStyle","keyStyle","setKeyStyle","valueStyle","setValueStyle","clearSub","setClearSub","reduce","p","c","lastIndex","setLastIndex","handleChangeSub","console","log","Object","keys","includes","data","map","txt","parseInt","String","parseFloat","text","backgroundColor","error","updateSubInfos","newSub","_sub","find","a","oldX","oldY","oldW","oldS","old","addNewText","addNewPage","updateSubtitleFile","fr","result","showImage","handleAddStyle","handleRemoveStyle","key","newStyles","handleClearAll","page1","position","left","overflowY","overflowX","zIndex","getLocalImage","visibility","height","getLocalSubtitle","alignItems","e","target","value","length","styleProp","replaceAll","download","JSON","stringify","filename","type","file","Blob","window","navigator","msSaveOrOpenBlob","document","createElement","url","URL","createObjectURL","href","body","appendChild","click","setTimeout","removeChild","revokeObjectURL","callback","evt","tgt","files","FileReader","onload","readAsDataURL","readAsText"],"mappings":"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","sourcesContent":["/* eslint-disable react/jsx-no-undef */\nimport React, { useEffect, useState } from \"react\";\nimport { Form, Button, DropdownButton, Dropdown, Row } from \"react-bootstrap\";\nimport {\n  parseObjectToPSRT,\n  parsePSRTFileToObject,\n  parsePSRTToObject,\n} from \"../service/subtitle\";\n\n//import DragScaleBar from 'react-drag-scale-bar'\n// import { Container } from './styles';\ntype TypeUseState<T> = (a: T | ((a: T) => T)) => void;\ntype TypeSub = {\n  [page: string]: {\n    x: number;\n    y: number;\n    index: number;\n    width: number;\n    size: number;\n    text: string;\n    style: React.CSSProperties;\n  }[];\n};\nconst EditSub: React.FC<{\n  sub: TypeSub;\n  setSub: TypeUseState<TypeSub>;\n  page?: string;\n  setPage: TypeUseState<string>;\n  setImage: TypeUseState<string>;\n  setImageStyle: TypeUseState<React.CSSProperties | string>;\n}> = ({\n  sub,\n  setSub,\n  page: defaultPage,\n  setPage: setDefaultPage,\n  setImage,\n  setImageStyle,\n}) => {\n  const [page, setPage] = useState(defaultPage || \"page1\");\n  const [isNewPage, setIsNewPage] = useState(false);\n  const [index, setIndex] = useState<string | number>(1);\n  const [x, setX] = useState<string | number>(0);\n  const [y, setY] = useState<string | number>(0);\n  const [width, setWidth] = useState<string | number>(0);\n  const [size, setSize] = useState<string | number>(0);\n  const [subText, setSubText] = useState(\"\");\n  const [show, setShow] = useState(true);\n  const [style, setStyle] = useState<{ [cssAttr: string]: string }>({});\n  const [keyStyle, setKeyStyle] = useState<string>(\"\");\n  const [valueStyle, setValueStyle] = useState<string>(\"\");\n  const [clearSub, setClearSub] = useState(sub ? sub : {});\n\n  const [lastIndex, setLastIndex] = useState(\n    sub[`${page}`]?.reduce((p, c) => (c.index > p ? c.index : p), 0) + 1\n  );\n\n  const handleChangeSub = () => {\n    console.log(Object.keys(clearSub));\n\n    if (Object.keys(clearSub).includes(page)) {\n      try {\n        setSub((data) => ({\n          ...data,\n          [page]: [\n            ...data[page]?.map((txt) => {\n              console.log(txt.index, index);\n\n              if (txt.index === parseInt(String(index))) {\n                return {\n                  ...txt,\n                  x: parseFloat(x),\n                  y: parseFloat(y),\n                  width: parseFloat(width),\n                  size: parseFloat(size),\n                  text: subText,\n                  style: {\n                    ...style,\n                    backgroundColor: \"#0f0\",\n                  },\n                };\n              } else {\n                if (txt.style.backgroundColor === \"#0f0\") {\n                  delete txt.style.backgroundColor;\n                }\n                return txt;\n              }\n            }),\n          ],\n        }));\n\n        setClearSub((data) => ({\n          ...data,\n          [page]: [\n            ...clearSub?.[page]?.map((txt) => {\n              if (txt.index === parseInt(String(index))) {\n                return {\n                  ...txt,\n                  x: parseFloat(x),\n                  y: parseFloat(y),\n                  width: parseFloat(width),\n                  size: parseFloat(size),\n                  text: subText,\n                  style: {\n                    ...style,\n                  },\n                };\n              } else {\n                return { ...txt };\n              }\n            }),\n          ],\n        }));\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  };\n\n  useEffect(() => {\n    //console.log(sub);\n    handleChangeSub();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [x, y, width, size, subText, style, defaultPage]);\n\n  const updateSubInfos = (newSub?: TypeSub) => {\n    const _sub = newSub || sub;\n    if (page) {\n      const text = _sub[page]?.find((a) => a.index === parseInt(String(index)));\n      setX((oldX) => text?.x || oldX);\n      setY((oldY) => text?.y || oldY);\n      setWidth((oldW) => text?.width || oldW);\n      setSize((oldS) => text?.size || oldS);\n      setSubText(text?.text || \"\");\n      setStyle((old) => (text?.style ? { ...text?.style } : { ...old }));\n    }\n  };\n\n  const addNewText = () => {\n    setSub((data) => ({\n      ...data,\n      [page]: [\n        ...data[page],\n        {\n          index: parseInt(String(lastIndex)),\n          x: parseFloat(String(x)),\n          y: parseFloat(String(y)),\n          width: parseFloat(String(width)),\n          size: parseFloat(String(size)),\n          text: subText,\n          style: {\n            ...style,\n            backgroundColor: \"#0f0\",\n          },\n        },\n      ],\n    }));\n\n    setClearSub((data) => ({\n      ...data,\n      [page]: [\n        ...data[page],\n        {\n          index: parseInt(String(lastIndex)),\n          x: parseFloat(String(x)),\n          y: parseFloat(String(y)),\n          width: parseFloat(String(width)),\n          size: parseFloat(String(size)),\n          text: subText,\n          style: {\n            ...style,\n          },\n        },\n      ],\n    }));\n\n    setIndex(lastIndex);\n    setLastIndex((old) => old + 1);\n  };\n\n  const addNewPage = () => {\n    if (isNewPage) {\n      setSub({\n        ...clearSub,\n        [page]: [\n          {\n            index: parseInt(String(0)),\n            x: parseFloat(String(x)),\n            y: parseFloat(String(y)),\n            width: parseFloat(String(width)),\n            size: parseFloat(String(size)),\n            text: subText,\n            style: {\n              ...style,\n              backgroundColor: \"#0f0\",\n            },\n          },\n        ],\n      });\n      setClearSub({\n        ...clearSub,\n        [page]: [\n          {\n            index: parseInt(String(0)),\n            x: parseFloat(String(x)),\n            y: parseFloat(String(y)),\n            width: parseFloat(String(width)),\n            size: parseFloat(String(size)),\n            text: subText,\n            style: {\n              ...style,\n            },\n          },\n        ],\n      });\n\n      updateSubInfos(sub);\n\n      setIndex(0);\n      setLastIndex(1);\n      setDefaultPage(page);\n      updateSubInfos();\n    }\n  };\n\n  const updateSubtitleFile = (fr: FileReader) => {\n    const newSub: TypeSub = parsePSRTToObject(String(fr.result));\n    setSub(newSub);\n    setClearSub(newSub);\n    setLastIndex(\n      newSub[page].reduce((p, { index }) => (index > p ? index : p), 0) + 1\n    );\n    updateSubInfos(newSub);\n  };\n  const showImage = (fr: FileReader) => setImage(String(fr.result));\n\n  const handleAddStyle = () => {\n    setStyle((old) => ({ ...old, [keyStyle]: valueStyle }));\n    setValueStyle(\"\");\n    setKeyStyle(\"\");\n  };\n\n  const handleRemoveStyle = (key: string) => {\n    setValueStyle(style[key]);\n    setKeyStyle(key);\n    const newStyles = { ...style };\n\n    delete newStyles[key];\n\n    setStyle(newStyles);\n  };\n\n  const handleClearAll = () => {\n    const newSub = {\n      page1: [],\n    };\n    setClearSub(newSub);\n\n    setSub(newSub);\n    setPage(\"page1\");\n    setIndex(0);\n    setLastIndex(0);\n  };\n\n  useEffect(() => {\n    updateSubInfos();\n  }, [index, page]);\n\n  useEffect(() => {\n    setIsNewPage(!Object.keys(sub).includes(page));\n    Object.keys(sub).includes(page) && setDefaultPage(page);\n    setLastIndex(\n      clearSub[page]?.reduce((p, { index }) => (index > p ? index : p), 0) + 1\n    );\n  }, [page]);\n\n  return (\n    <Form\n      style={{\n        position: \"fixed\",\n        width: \"500px\",\n        left: 0,\n        overflowY: \"auto\",\n        overflowX: \"hidden\",\n        zIndex: 50,\n      }}\n    >\n      <div className={`form-check form-switch mr-0`}>\n        <input\n          className=\"form-check-input\"\n          type=\"checkbox\"\n          onClick={() => setShow((a) => !a)}\n          id=\"flexSwitchCheckChecked\"\n          checked={show}\n        />\n        <label className=\"form-check-label\" htmlFor=\"flexSwitchCheckChecked\">\n          Settings\n        </label>\n      </div>\n      {show && (\n        <div>\n          <Row className=\"mb-2\">\n            <Form.Group className=\" col-4 mb-0\" controlId=\"subtitle-file\">\n              <Form.Label className=\"btn btn-primary\">Load Image</Form.Label>\n              <Form.Control\n                onChange={getLocalImage(showImage)}\n                type=\"file\"\n                style={{ visibility: \"hidden\", height: \"0px\" }}\n                placeholder=\"Image\"\n              />\n            </Form.Group>\n\n            <Form.Group className=\" col-4 mb-0\" controlId=\"image-file\">\n              <Form.Label className=\"btn btn-primary\">Load SubTitle</Form.Label>\n              <Form.Control\n                onChange={getLocalSubtitle(updateSubtitleFile)}\n                type=\"file\"\n                style={{ visibility: \"hidden\", height: \"0px\" }}\n                placeholder=\"Image\"\n              />\n            </Form.Group>\n\n            <Button\n              className=\" col-2\"\n              onClick={handleClearAll}\n              variant=\"danger\"\n            >\n              Clear All\n            </Button>\n          </Row>\n\n          <Row style={{ alignItems: \"flex-end\" }}>\n            <Form.Group className=\" col-3 mb-0\" controlId=\"formPage\">\n              <Form.Label>Page</Form.Label>\n              <Form.Control\n                value={page}\n                onChange={(e) => setPage(e.target.value)}\n                placeholder=\"Page\"\n              />\n            </Form.Group>\n\n            <Button\n              className=\" col-2\"\n              onClick={addNewPage}\n              disabled={!isNewPage}\n              variant=\"primary\"\n            >\n              Add page\n            </Button>\n\n            <Form.Group className=\" col-3 mb-0\" controlId=\"formIndex\">\n              <Form.Label>Index</Form.Label>\n              <Form.Control\n                value={index}\n                onChange={(e) => setIndex(e.target.value)}\n                type=\"number\"\n                min=\"0\"\n                max={sub[String(page)]?.length}\n                step=\"1\"\n                placeholder=\"index\"\n              />\n            </Form.Group>\n\n            <Button className=\" col-2\" onClick={addNewText} variant=\"primary\">\n              Add Text\n            </Button>\n          </Row>\n          <Row>\n            <Form.Group className=\" col-3\" controlId=\"formX\">\n              <Form.Label>X axis</Form.Label>\n              <Form.Control\n                value={x}\n                onChange={(e) => setX(e.target.value)}\n                type=\"number\"\n                min=\"0\"\n                max=\"100\"\n                step=\"0.1\"\n                placeholder=\"X\"\n              />\n            </Form.Group>\n\n            <Form.Group className=\" col-3\" controlId=\"formY\">\n              <Form.Label>Y axis</Form.Label>\n              <Form.Control\n                value={y}\n                onChange={(e) => setY(e.target.value)}\n                type=\"number\"\n                min=\"0\"\n                max=\"100\"\n                step=\"0.1\"\n                placeholder=\"Y\"\n              />\n            </Form.Group>\n\n            <Form.Group className=\" col-3\" controlId=\"formY\">\n              <Form.Label>Size</Form.Label>\n              <Form.Control\n                value={size}\n                onChange={(e) => setSize(e.target.value)}\n                type=\"number\"\n                min=\"0\"\n                max=\"100\"\n                step=\"0.1\"\n                placeholder=\"size\"\n              />\n            </Form.Group>\n            <Form.Group className=\" col-3\" controlId=\"formWidth\">\n              <Form.Label>Width</Form.Label>\n              <Form.Control\n                value={width}\n                onChange={(e) => setWidth(e.target.value)}\n                type=\"number\"\n                min=\"0\"\n                max=\"100\"\n                step=\"0.1\"\n                placeholder=\"width\"\n              />\n            </Form.Group>\n          </Row>\n          <Row>\n            <Form.Group className=\" col-8\" controlId=\"formText\">\n              <Form.Label>Text</Form.Label>\n              <Form.Control\n                value={subText}\n                onChange={(e) => setSubText(e.target.value)}\n                type=\"text\"\n                placeholder=\"width\"\n              />\n            </Form.Group>\n            {Object.keys(style).length > 0 && (\n              <DropdownButton\n                className=\"col-4\"\n                variant=\"secondary\"\n                id=\"dropdown-basic-button\"\n                title=\"Styles\"\n              >\n                {Object.keys(style).length > 0 &&\n                  Object.keys(style)?.map((styleProp) => (\n                    <Dropdown.Item\n                      onClick={() => handleRemoveStyle(styleProp)}\n                      key={styleProp}\n                    >\n                      {`${styleProp.replaceAll(\"_\", \" \")} : ${\n                        style[styleProp]\n                      }`}\n                    </Dropdown.Item>\n                  ))}\n              </DropdownButton>\n            )}\n          </Row>\n          <Row>\n            <Form.Group className=\" col-4\" controlId=\"formKeyStyle\">\n              <Form.Control\n                value={keyStyle}\n                onChange={(e) => setKeyStyle(e.target.value)}\n                type=\"text\"\n                placeholder=\"key\"\n              />\n            </Form.Group>\n            <Form.Group className=\" col-4\" controlId=\"formValueStyle\">\n              <Form.Control\n                value={valueStyle}\n                onChange={(e) => setValueStyle(e.target.value)}\n                type=\"text\"\n                placeholder=\"value\"\n              />\n            </Form.Group>\n\n            <Button\n              style={{ height: \"100%\" }}\n              className=\"p-2 col-4 btn-secondary\"\n              onClick={handleAddStyle}\n            >\n              Add Style\n            </Button>\n          </Row>\n          <div>\n            <Button\n              onClick={() =>\n                download(parseObjectToPSRT(clearSub), \"sub.psrt\", \"jpg\")\n              }\n              variant=\"primary\"\n            >\n              Dowload Subtitle (.psrt)\n            </Button>\n            <Button\n              onClick={() =>\n                download(JSON.stringify(clearSub), \"sub.json\", \"jpg\")\n              }\n              variant=\"primary\"\n            >\n              Dowload Subtitle (.json)\n            </Button>\n          </div>\n        </div>\n      )}\n    </Form>\n  );\n};\n\nfunction download(data, filename, type) {\n  var file = new Blob([data], { type: type });\n  if (window.navigator.msSaveOrOpenBlob)\n    // IE10+\n    window.navigator.msSaveOrOpenBlob(file, filename);\n  else {\n    // Others\n    var a = document.createElement(\"a\"),\n      url = URL.createObjectURL(file);\n    a.href = url;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n    setTimeout(function () {\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n    }, 0);\n  }\n}\n\nconst getLocalImage = (callback: (fr: FileReader) => any) => (evt) => {\n  let tgt = evt.target;\n  let files = tgt.files;\n\n  // FileReader support\n  if (FileReader && files && files.length) {\n    let fr = new FileReader();\n    fr.onload = () => callback(fr);\n    fr.readAsDataURL(files[0]);\n  }\n};\n\nconst getLocalSubtitle = (callback: (fr: FileReader) => any) => (evt) => {\n  let tgt = evt.target;\n  let files = tgt.files;\n\n  // FileReader support\n  if (FileReader && files && files.length) {\n    let fr = new FileReader();\n    fr.onload = () => callback(fr);\n    fr.readAsText(files[0]);\n  }\n};\n\nexport default EditSub;\n"]},"metadata":{},"sourceType":"module"}