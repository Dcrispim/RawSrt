{"ast":null,"code":"import _slicedToArray from\"/home/intelie/Documents/srt2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/home/intelie/Documents/srt2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";export var parsePSRTFileToObject=function parsePSRTFileToObject(file){var out={};var currentPage=\"\";var rawFile=new XMLHttpRequest();rawFile.open(\"GET\",file,false);rawFile.onreadystatechange=function(){if(rawFile.readyState===4){if(rawFile.status===200||rawFile.status==0){out=_objectSpread({},parsePSRTToObject(rawFile.responseText));}}};rawFile.send(null);return out;};export var parsePSRTToObject=function parsePSRTToObject(subtitle){var out={};var currentPage=\"\";var i=0;var lastIndex=0;subtitle.split(\"\\n\").map(function(line){if(line.includes(\"$START\")){currentPage=line.substring(6).trim();out[line.substring(6).trim()]=[];}else if(line.includes(\"$END\")){currentPage=\"\";}else if(line.includes(\">>\")){var _out$currentPage,_clearLine$split;var clearLine=line.substring(2);var _clearLine$split$0$sp=clearLine.split(\"/\")[0].split(\"-\"),_clearLine$split$0$sp2=_slicedToArray(_clearLine$split$0$sp,4),x=_clearLine$split$0$sp2[0],y=_clearLine$split$0$sp2[1],s=_clearLine$split$0$sp2[2],w=_clearLine$split$0$sp2[3];(_out$currentPage=out[currentPage])===null||_out$currentPage===void 0?void 0:_out$currentPage.push({index:clearLine.split(\"/\")[2]?parseInt(clearLine.split(\"/\")[2]):lastIndex+i,x:parseFloat(x),y:parseFloat(y),size:parseFloat(s),width:parseFloat(w),style:JSON.parse((_clearLine$split=clearLine.split(\"/\"))===null||_clearLine$split===void 0?void 0:_clearLine$split[1])});lastIndex=clearLine.split(\"/\")[2]?parseInt(clearLine.split(\"/\")[2]):lastIndex;i+=1;}else if(line.length>1){var _out$currentPage2;if(((_out$currentPage2=out[currentPage])===null||_out$currentPage2===void 0?void 0:_out$currentPage2.length)>0){var _out$currentPage3;out[currentPage][((_out$currentPage3=out[currentPage])===null||_out$currentPage3===void 0?void 0:_out$currentPage3.length)-1].text=line;}}});return out;};export var parseObjectToPSRT=function parseObjectToPSRT(sub){var out=\"\";Object.keys(sub).map(function(page){out+=\"$START \".concat(page,\"\\n\");sub[page].map(function(_ref,i){var x=_ref.x,y=_ref.y,size=_ref.size,width=_ref.width,text=_ref.text,style=_ref.style,index=_ref.index;out+=\">>\".concat(x,\"-\").concat(y,\"-\").concat(size,\"-\").concat(width,\" \").concat(JSON.stringify(style),\" \").concat(index||i,\"\\n\");out+=\"\".concat(text,\"\\n\\n\");});out+=\"$END \".concat(page,\"\\n\\n\");});return out;};","map":{"version":3,"sources":["/home/intelie/Documents/srt2/src/service/subtitle.ts"],"names":["parsePSRTFileToObject","file","out","currentPage","rawFile","XMLHttpRequest","open","onreadystatechange","readyState","status","parsePSRTToObject","responseText","send","subtitle","i","lastIndex","split","map","line","includes","substring","trim","clearLine","x","y","s","w","push","index","parseInt","parseFloat","size","width","style","JSON","parse","length","text","parseObjectToPSRT","sub","Object","keys","page","stringify"],"mappings":"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","sourcesContent":["export const parsePSRTFileToObject = (\n  file: string\n): {\n  [page: string]: {\n    x: number;\n    y: number;\n    index: number;\n    width: number;\n    size: number;\n    text: string;\n    style: React.CSSProperties;\n  }[];\n} => {\n  let out: { [k: string]: any } = {};\n  let currentPage = \"\";\n  let rawFile = new XMLHttpRequest();\n  rawFile.open(\"GET\", file, false);\n  rawFile.onreadystatechange = function () {\n    if (rawFile.readyState === 4) {\n      if (rawFile.status === 200 || rawFile.status == 0) {\n        out = { ...parsePSRTToObject(rawFile.responseText) };\n      }\n    }\n  };\n\n  rawFile.send(null);\n\n  return out;\n};\n\nexport const parsePSRTToObject = (subtitle: string) => {\n  let out: { [k: string]: any } = {};\n  let currentPage = \"\";\n\n  let i = 0;\n  let lastIndex = 0;\n\n  subtitle.split(\"\\n\").map((line) => {\n    if (line.includes(\"$START\")) {\n      currentPage = line.substring(6).trim();\n      out[line.substring(6).trim()] = [];\n    } else if (line.includes(\"$END\")) {\n      currentPage = \"\";\n    } else if (line.includes(\">>\")) {\n      const clearLine = line.substring(2);\n      const [x, y, s, w] = clearLine.split(\"/\")[0].split(\"-\");\n      out[currentPage]?.push({\n        index: clearLine.split(\"/\")[2]\n          ? parseInt(clearLine.split(\"/\")[2])\n          : lastIndex + i,\n        x: parseFloat(x),\n        y: parseFloat(y),\n        size: parseFloat(s),\n        width: parseFloat(w),\n        style: JSON.parse(clearLine.split(\"/\")?.[1]),\n      });\n      lastIndex = clearLine.split(\"/\")[2]\n        ? parseInt(clearLine.split(\"/\")[2])\n        : lastIndex;\n\n      i += 1;\n    } else if (line.length > 1) {\n      if (out[currentPage]?.length > 0) {\n        out[currentPage][out[currentPage]?.length - 1].text = line;\n      }\n    }\n  });\n\n  return out;\n};\n\nexport const parseObjectToPSRT = (sub: {\n  [page: string]: {\n    x: number;\n    y: number;\n    width: number;\n    size: number;\n    text: string;\n    index: number;\n    style: React.CSSProperties;\n  }[];\n}): string => {\n  let out = \"\";\n\n  Object.keys(sub).map((page) => {\n    out += `$START ${page}\\n`;\n    sub[page].map(({ x, y, size, width, text, style, index }, i) => {\n      out += `>>${x}-${y}-${size}-${width} ${JSON.stringify(style)} ${\n        index || i\n      }\\n`;\n      out += `${text}\\n\\n`;\n    });\n    out += `$END ${page}\\n\\n`;\n  });\n  return out;\n};\n"]},"metadata":{},"sourceType":"module"}